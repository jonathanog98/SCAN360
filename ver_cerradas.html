
<!doctype html><html lang="es"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Scan360 | Inspecciones cerradas</title>
<link rel="stylesheet" href="style-sutra.css"/>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script defer src="env.js"></script>
<script defer src="app.js"></script>
</head><body>
<div class="nav"><div class="nav-inner">
  <div class="logo">Scan360</div>
  <div class="tabs"><div class="tab active">Cerradas</div></div>
</div></div>

<div class="container">
  <div id="content"><!-- Cards render here --></div>

  <!-- Botón de inicio SIEMPRE visible -->
  <div class="actions" style="margin-top:20px">
    <a href="index.html"><button class="btn outline">Inicio</button></a>
  </div>
</div>

<script>
  function statusProgressCard(c){
    const s1='filled', s2=c.entrada_at?'filled':'', s3=c.status==='closed'?'filled':'';
    return `<div class="progress"><div class="step ${s1}"></div><div class="step ${s2}"></div><div class="step ${s3}"></div></div>`;
  }
  function render(list){
    const host=document.getElementById('content');
    if(!list.length){
      host.innerHTML='<div class="card"><div>No hay inspecciones cerradas para esta tablilla.</div></div>';
      return;
    }
    host.innerHTML=list.map(c=>{
      const s=c.salida_at?new Date(c.salida_at).toLocaleString():'-';
      const e=c.entrada_at?new Date(c.entrada_at).toLocaleString():'-';
      return `<div class="card">
        <h3>Inspección • ${c.plate} <span class="badge status-closed">Cerrada</span></h3>
        <div class="kv">Salida: ${s} &nbsp; | &nbsp; Entrada: ${e}</div>
        ${statusProgressCard(c)}
        <div style="margin-top:10px"><a class="btn outline small" href="ver.html?case=${c.id}">Detalle</a></div>
      </div>`;
    }).join('');
  }
  window.addEventListener('DOMContentLoaded', async ()=>{
    initSupabase();
    const plate=(sessionStorage.getItem('plate')||'').toUpperCase();
    if(!plate) return location.href='index.html';
    const rows = await getClosedCasesByPlate(plate);
    render(rows);
  });
</script>
</body></html>
